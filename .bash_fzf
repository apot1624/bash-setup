rgf() {
  local pattern="$1"
  shift
  if [[ -z "$pattern" ]]; then
    echo "Error: missing search pattern" >&2
    return 1
  fi

  local extra_opts=()
  local less_opts=()

  # 解析参数，支持组合短选项（如 -sae）
  while [[ $# -gt 0 ]]; do
    local arg="$1"
    if [[ "$arg" =~ ^-[a-zA-Z0-9]{2,}$ ]]; then
      # 拆解组合选项
      local chars="${arg:1}"
      for (( i=0; i<${#chars}; i++ )); do
        local c="${chars:$i:1}"
        extra_opts+=("-$c")
      done
      shift
    else
      extra_opts+=("$arg")
      shift
    fi
  done

  # 检查 extra_opts 中是否有 -i，有则 less_opts 加上 -I
  for opt in "${extra_opts[@]}"; do
    if [[ "$opt" == "-i" ]]; then
      less_opts=("-I")
      break
    fi
  done

  # 执行搜索
  rg --vimgrep --color=always "${extra_opts[@]}" "$pattern" | sort -t: -k1,1 -k2,2n | \
    fzf --ansi --delimiter : \
        --preview 'bat --color=always --highlight-line {2} {1}' \
        --preview-window 'up,80%,border-bottom,+{2}' \
        --bind "enter:execute(bat {1} --pager='less -R ${less_opts[@]} +{2} +/\"$pattern\"')" \
        --bind "ctrl-o:execute(vim {1} +{2})" \
        --bind "ctrl-l:execute(source ~/.bash_vscode && lingma -g {1}:{2})"
}
